# Планирование Переработки Системы Агентов

## Цель
Полная переработка пакета `internal/simulation/agents` для реализации сложной многоагентной симуляции с экономическими взаимодействиями, зависящими от виртуального времени симуляции.

## 1. Управление Временем Симуляции
Вместо использования глобального `time.Ticker` и реального времени, симуляция будет управляться централизованным движком (`SimulationEngine`).
*   **Виртуальное время**: Агенты получают сигналы о наступлении нового "тика" или события с контекстом текущего виртуального времени.
*   **Детерминированность**: Логика агентов зависит только от переданного времени симуляции, что позволит ускорять или замедлять симуляцию без влияния на логику.

## 2. Типология Агентов
Мы разделим агентов на две основные категории: **Экономические Субъекты (Бизнес)** и **Физические Лица (Люди)**.

### 2.1. Физические Лица (Simple Agents / Individuals)
Простые агенты, имитирующие поведение людей.
*   **Роли**: Потребитель, Работник.
*   **Потребности**: Покупка товаров (еда, техника), оплата услуг (ЖКХ, развлечения).
*   **Доходы**: Зарплата от работодателя.
*   **Жизненный цикл**: Трудоустройство -> Работа -> Получение ЗП -> Траты -> Сбережения.

### 2.2. Юридические Лица и Предприниматели
Агенты, предоставляющие работу и товары/услуги.
*   **Компания (Company)**: Крупный бизнес. Большой штат сотрудников, высокие обороты.
*   **Магазин (Shop)**: Точка продаж. Продает товары простым агентам. Может быть частью компании или отдельным бизнесом.
*   **ИП (Individual Entrepreneur)**: Малый бизнес. Может нанимать небольшое количество людей. 
*   **Самозанятый (Self-employed)**: Работает сам на себя, оказывает услуги, не нанимает сотрудников, но получает доход от других агентов.

## 3. Экономические Взаимодействия
Взаимодействия реализуются через обмен сообщениями или транзакции в рамках симуляции.

*   **Трудовые отношения (Employment)**:
    *   Агент-работодатель (Компания/ИП/Магазин) нанимает Агента-работника.
    *   Регулярная выплата зарплаты (в определенные дни симуляции).
*   **Торговля (Commerce)**:
    *   Магазины и Компании выставляют товары/услуги.
    *   Простые агенты выбирают, где и что купить, и переводят деньги.
*   **Банковские операции**:
    *   Все агенты взаимодействуют с банком для проведения переводов (ЗП, покупки).

## 4. Предлагаемая Структура Пакетов

```text
internal/simulation/
├── engine/              # Ядро симуляции
│   ├── loop.go          # Цикл симуляции (Tick loop)
│   └── time.go          # Управление виртуальным временем
├── economy/             # Экономические примитивы
│   ├── market.go        # Реестр доступных товаров/услуг
│   └── labor.go         # Биржа труда / Контракты
├── agents/              # Реализация агентов
│   ├── base.go          # Базовый интерфейс и общая логика
│   ├── individual.go    # Логика простого человека (Simple Agent)
│   ├── business/        # Бизнес-логика
│   │   ├── company.go   # ООО / Корпорации
│   │   ├── shop.go      # Магазины
│   │   └── entrepreneur.go # ИП и Самозанятые
│   └── factory.go       # Фабрика для создания агентов
└── types/               # Общие типы данных для симуляции
```

## 5. План Реализации

### Этап 1: Ядро Симуляции (Engine)
1.  Создать `SimulationEngine` и интерфейс `Clock`.
2.  Реализовать цикл `Run(ctx)`, который рассылает `Tick(currentTime)` всем зарегистрированным агентам.

### Этап 2: Базовые Интерфейсы
1.  Определить интерфейс `Agent`:
    ```go
    type Agent interface {
        ID() uuid.UUID
        OnTick(currentTime time.Time, economy *EconomyContext) error
    }
    ```
2.  Создать структуру для состояния агента (баланс, инвентарь, текущие задачи).

### Этап 3: Реализация Бизнес-Агентов
1.  **Company/Shop**: Логика найма (выставление вакансий) и продажи (выставление товаров).
2.  **IP/SelfEmployed**: Упрощенная логика бизнеса.

### Этап 4: Реализация Простых Агентов (Людей)
1.  Поиск работы и заключение контракта.
2.  Цикл "Работа" (трата времени) -> "Зарплата" (получение денег).
3.  Цикл "Потребление" (выбор магазина -> транзакция).

### Этап 5: Интеграция с Банком
1.  Подключение существующих сервисов (`AccountService`, `TransactionService`) к агентам.
2.  Агенты совершают реальные вызовы к сервисам банка внутри симуляции.
